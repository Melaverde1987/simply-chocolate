<section id="howitsmade" class="how-its-made">
  <div class="container">
    <h2 class="headline">How it's <span>made?</span></h2>
    <div class="how-its-made-inner">
      <div class="video-container" id="videocontainer">
        <link rel="preconnect" href="https://www.youtube-nocookie.com" />
        <link rel="preconnect" href="https://i.ytimg.com" />
        <div
          class="yt-lite"
          data-ytid="xPe1jMuX32s"
          aria-label="Play video"
          role="button"
          tabindex="0"
        >
          <picture>
            <source
              srcset="
                /img/how-its-made/how.jpg    1x,
                /img/how-its-made/how@2x.jpg 2x
              "
              media="(min-width: 1200px)"
            />
            <img
              id="image"
              src="/img/how-its-made/how.jpg"
              alt="chocolate video preview"
              width="760"
              height="500"
              class="how-its-made-video"
              loading="lazy"
            />
          </picture>
          <div class="yt-play"></div>
          <noscript>
            <iframe
              src="https://www.youtube-nocookie.com/embed/xPe1jMuX32s"
              title="YouTube video"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowfullscreen
              loading="lazy"
            ></iframe>
          </noscript>
        </div>
      </div>
      <div class="text-container">
        <h3>
          Try our chocolates today and discover the perfect balance of flavor
        </h3>
        <ul class="made-list">
          <li class="list-item">
            Heat the milk in a saucepan without bringing it to a boil. Add sugar
            and cocoa powder.
          </li>
          <li class="list-item">
            At the same time, prepare a water bath. Melt the butter on it.
          </li>
          <li class="list-item">
            "Mix" the milk mixture and already liquid butter. Mix thoroughly
            with a silicone spatula so that the mass becomes uniform and silky.
          </li>
          <li class="list-item">
            Heat the mixture over low heat, letting it barely boil.
          </li>
          <li class="list-item">
            Pour the chocolate into special containers (can be replaced with ice
            molds). Allow to cool and harden.
          </li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    function loadYT(el) {
      if (el.dataset.loaded) return;
      el.dataset.loaded = '1';
      const id = el.dataset.ytid;
      const iframe = document.createElement('iframe');
      iframe.src =
        'https://www.youtube-nocookie.com/embed/' +
        id +
        '?autoplay=1&rel=0&modestbranding=1';
      iframe.title = 'YouTube video';
      iframe.loading = 'eager'; // після кліку — можна eager
      iframe.allow =
        'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share';
      iframe.allowFullscreen = true;
      el.innerHTML = ''; // прибрати прев'ю
      el.appendChild(iframe);
    }

    document.addEventListener('click', e => {
      const el = e.target.closest('.yt-lite');
      if (el) loadYT(el);
    });
    document.addEventListener('keydown', e => {
      if (!['Enter', ' '].includes(e.key)) return;
      const el = document.activeElement.closest?.('.yt-lite');
      if (el) {
        e.preventDefault();
        loadYT(el);
      }
    });

    // Опційно: lazy-ініціалізація превю, якщо їх багато (відтермінувати завантаження тумбів)
    const lites = document.querySelectorAll('.yt-lite');
    if ('IntersectionObserver' in window) {
      const io = new IntersectionObserver(entries => {
        for (const ent of entries) {
          if (ent.isIntersecting) {
            const img = ent.target.querySelector('.yt-thumb');
            if (img && img.dataset.src) {
              img.src = img.dataset.src;
            }
            io.unobserve(ent.target);
          }
        }
      });
      lites.forEach(el => io.observe(el));
    }
  </script>
</section>
